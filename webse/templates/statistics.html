{% extends "layout.html" %}
{% block content %}
<div class="container">
    <h2>Statistics:</h2>
    <div class="row">
        <div class="content-section">
            <form method="POST" action="{{url_for('statistics')}}"  >
                {{ mod_form.csrf_token }}
                    <!--<legend class="border-bottom mb-4">App Module Data</legend>-->
                    <div class="form-group">
                            {{ mod_form.mod_type(class="form-control form-control-lg") }}
                    </div>
                    </br>
                    <div class="form-group border-bottom pb-3">
                            {{ mod_form.chapter(class="form-control form-control-lg") }}
                    </div>
                    </br>
                    <div class="form-group border-bottom pb-3">
                            {{ mod_form.submit(class="btn btn-outline-info")}}
                    </div>
            </form>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-8">
            <table class="table">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">User</th>
                        <th scope="col">Date</th>
                        <th scope="col">Module</th>
                        <th scope="col">Chapter</th>
                        <th scope="col">Question Number</th>
                        <th scope="col">Result</th>
                        <th scope="col">Link Exercise</th>
                    </tr>
                </thead>
                <tbody>
                    {% if entries_app %}
                        {% for entry in entries_app %}
                            <tr>
                                <th scope="row">{{ current_user.username }}</th>
                                <td>{{ entry.date_exercise.strftime("%m-%d-%Y") }}</td>
                                <td>{{ entry.title_mo }}</td>
                                <td>{{ entry.title_ch }}</td>
                                <td>{{ entry.question_num }}</td>
                                <td>{{ entry.question_result }}</td>
                                <td><a href="{{ url_for('home') }}" class="btn btn-outline-info btn-sm">Link</a></td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                        </tr>   
                    {% endif %}
                </tbody>
            </table>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
            <div class="card card-style mb-2">
                <div class="card-body">
                    <div class="chart-container" style="position: relative;">
                        <canvas id="app_correct_vs_incorrect"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block javascript %}
<script>

    Chart.scaleService.updateScaleDefaults('linear', {
            ticks: {
                min: 0
            }
    });


    let app_correct_vs_incorrect_chart = new Chart(app_correct_vs_incorrect, {
            type: 'pie',
            data: {
            labels: ['correct', 'incorrect'],
                datasets: [{
                    label: "Correct Vs Incorrect",
                    data: [{{app_correct}}, {{app_incorrect}}],
                    backgroundColor: ['#5DA5DA ', '#FAA43A', '#60BD68',
                        '#B276B2', '#E16851', '#FB8267'],

                    borderWidth: 1,
                    hoverBorderColor: "black",
                    hoverBorderWidth: 2,
                    hoverBackgroundColor: 'rgba(154, 245, 140)',
                    pointHoverRadius: 5
                }],
            },
            options: {
                    title: {
                        display: true,
                            text: document.getElementById("mod_type").value,
                                fontSize: 20,
                    },
                    legend: {
                        position: "right",
                            labels: {
                            fontColor: "gray"
                        },
                        display: true,
                    },

                    elements: {
                        hitRadius: 3,
                    }
            }
        })
</script>
<script>
    let mod_select =document.getElementById("mod_type");
    let chap_select = document.getElementById("chapter");

    mod_select.onchange = function(){
    mod=mod_select.value;

    fetch('/chapter_type/'+mod).then(function(response) {
        response.json().then(function(data){
            let optionHTML='';

            for(let chap_in of data.chap_json){
                optionHTML += '<option value="' + chap_in.chap + '">' +chap_in.chap +'</option>';
            }

            chap_select.innerHTML = optionHTML;
        });
    });
    }
    if ( document.querySelector('select') ) {
			document.querySelector('select').value =  document.getElementById("mod_type");
		}
</script>
{% endblock%}
{% endblock content %}
